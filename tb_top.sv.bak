`include "uart_intf.sv"    // Interface file zaroor include karein
`include "environment.sv"  // Environment file

module tb_top;
    
    // 1. Clock and Reset Declaration
    bit clk;
    bit rst;

    // 2. Clock Generation (10ns Period -> 100MHz)
    always #5 clk = ~clk;

    // 3. Reset Logic (Zaroori hai UART State Machine reset karne ke liye)
    initial begin
        rst = 1;       // Pehle Reset ON
        #20 rst = 0;   // 20ns baad Reset OFF (System Active)
    end

    // 4. Interface Instantiation
    // Hum clk aur rst yahan se interface mein bhej rahe hain
    uart_intf vif(clk, rst); 

    // 5. DUT Instantiation (Apna RTL Module yahan connect karo)
    // NOTE: 'uart_top' ka naam wahi rakhna jo tumhare RTL code mein hai
    uart_top dut (
        .clk(vif.clk),
        .rst(vif.rst),
        
        // Sender A connections
        .tx_start_A(vif.tx_start_A),
        .data_in_A(vif.data_in_A),
        .tx_A(vif.tx_A),
        .rx_done_A(vif.rx_done_A),
        
        // Sender B connections (Agar Dual UART hai)
        .tx_start_B(vif.tx_start_B),
        .data_in_B(vif.data_in_B),
        .tx_B(vif.tx_B),
        .rx_done_B(vif.rx_done_B)
    );

    // 6. Environment Declaration
    // UART env usually fixed width ka hota hai, isliye parameter N hata diya
    environment env; 

    // 7. Test Start Block
    initial begin
        // Environment ko Interface handle pass kiya
        env = new(vif);
        
        // Test run kiya (Generator -> Driver -> Monitor -> Scoreboard -> Coverage)
        env.run();
    end

    // 8. Waveform Dump (GTKWave ke liye)
    initial begin
        $dumpfile("uart_dump.vcd");
        $dumpvars(0, tb_top);
    end

endmodule